<!-- src/app/studentfeedback/studentfeedback.component.html -->
<app-navbar2></app-navbar2>
<app-student-header></app-student-header>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h3 class="card-title mb-0">√âvaluation de l'Exp√©rience de Mobilit√©</h3>
          <small>Partagez votre retour d'exp√©rience sur diff√©rents aspects pour nous aider √† am√©liorer nos programmes</small>
        </div>
        
        <div class="card-body">
          <!-- Message Alert -->
          <div *ngIf="message" class="alert" [class.alert-success]="messageType === 'success'" [class.alert-danger]="messageType === 'error'">
            {{ message }}
          </div>

          <!-- Offer Selection -->
          <div class="mb-4">
            <label class="form-label fw-bold">S√©lectionnez le Programme de Mobilit√© :</label>
            <select class="form-select" (change)="onOfferSelect($any($event.target).value)" [disabled]="isLoading">
              <option value="">-- Choisir un programme --</option>
              <option *ngFor="let offer of offers" [value]="offer.id">
                {{ offer.type }} - {{ offer.universite }} ({{ offer.dateDebut | date }} √† {{ offer.dateFin | date }})
              </option>
            </select>
          </div>

          <!-- Explanation Section -->
          <div *ngIf="selectedOfferId" class="alert alert-info mb-4">
            <h6>Crit√®res d'√âvaluation :</h6>
            <ul class="mb-0">
              <li><strong>üéì Exp√©rience Acad√©mique :</strong> Pertinence des cours, m√©thodes d'enseignement, ressources p√©dagogiques</li>
              <li><strong>üè† Vie √âtudiante :</strong> Qualit√© du logement, int√©gration sociale, activit√©s culturelles</li>
              <li><strong>üåç Adaptation Culturelle :</strong> Barri√®re linguistique, accueil local, int√©gration sociale</li>
              <li><strong>üìã Aspects Pratiques :</strong> Support administratif, co√ªt de la vie, accessibilit√©</li>
              <li><strong>üéØ Satisfaction Globale :</strong> Exp√©rience g√©n√©rale et d√©veloppement personnel</li>
            </ul>
          </div>

          <!-- Already Submitted Message -->
          <div *ngIf="hasAlreadySubmitted && existingFeedback" class="alert alert-info">
            <p>Vous avez d√©j√† soumis votre √©valuation pour ce programme le {{ existingFeedback.submissionDate | date:'medium' }}.</p>
            <p>Vous pouvez consulter vos notes ci-dessous.</p>
          </div>

          <!-- Feedback Form -->
          <form *ngIf="selectedOfferId && (!hasAlreadySubmitted || existingFeedback)" (ngSubmit)="onSubmit()">
            
            <!-- Rating Categories -->
            <div class="row">
              <div class="col-md-6" *ngFor="let category of ratingCategories">
                <app-star-rating-component
                  [label]="category.label"
                  [rating]="getRatingValue(category.key)"
                  [disabled]="hasAlreadySubmitted"
                  (ratingChange)="onRatingChange($event, category.key)">
                </app-star-rating-component>
              </div>
            </div>

            <!-- Additional Comments -->
            <div class="mb-4">
              <label class="form-label fw-bold">Commentaires Additionnels (Optionnel) :</label>
              <textarea 
                class="form-control" 
                rows="4" 
                [(ngModel)]="feedback.additionalComments" 
                name="additionalComments"
                [disabled]="hasAlreadySubmitted || isLoading"
                placeholder="Partagez vos r√©flexions suppl√©mentaires sur votre exp√©rience...">
              </textarea>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button 
                type="button" 
                class="btn btn-secondary me-md-2" 
                (click)="goToDashboard()">
                Annuler
              </button>
              <button 
                type="submit" 
                class="btn btn-primary"
                [disabled]="!isFormValid() || hasAlreadySubmitted || isLoading">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                {{ hasAlreadySubmitted ? 'D√©j√† Soumis' : 'Soumettre l\'√âvaluation' }}
              </button>
            </div>
          </form>

          <!-- No Offers Message -->
          <div *ngIf="offers.length === 0" class="alert alert-warning">
            Vous n'avez aucun programme de mobilit√© termin√© pour lequel fournir une √©valuation.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>