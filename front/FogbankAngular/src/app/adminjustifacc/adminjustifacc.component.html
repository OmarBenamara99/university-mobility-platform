<!-- Page Wrapper -->
<app-navbar3></app-navbar3>
<div class="page-content">
  <div class="container">
    <div class="row">

      <!-- Sidebar -->
      <div class="col-xl-3 col-lg-4 col-md-12 theiaStickySidebar">
        <app-sidebar2></app-sidebar2>
      </div>
      <!-- /Sidebar -->







<!-- Admin Acceptance Proofs Dashboard -->
<div class="col-xl-9 col-lg-8 col-md-12">	
    <div class="tak-instruct-group">
        <div class="row">
            <div class="col-md-12">
                <div class="settings-widget">
                    <div class="settings-inner-blk p-0">
                        <div class="sell-course-head comman-space">
                            <h3>Justificatifs d'Acceptation - Revue des documents</h3>
                            <p>Gérez et validez les lettres d'acceptation et preuves d'inscription des étudiants.</p>
                        </div>
                    </div>
                </div>
                <div class="settings-widget">
                    <div class="settings-inner-blk p-0">
                        <div class="comman-space pb-0">
                            <div class="sell-course-head withdraw-history-head border-bottom-0">
                                <h3>Justificatifs d'Acceptation</h3>
                            </div>
                            <div class="instruct-search-blk mb-0">
                                <form action="#">
                                    <div class="row gx-2 align-items-center">	
                                        <div class="col-md-6 col-lg-4 col-item">
                                            <div class="input-block select-form mb-0">
                                                <select class="form-select select" [(ngModel)]="statusFilter" [ngModelOptions]="{standalone: true}">
                                                    <option value="">Tous les statuts</option>
                                                    <option value="PENDING_UPLOAD">En attente document</option>
                                                    <option value="UNDER_REVIEW">En revue</option>
                                                    <option value="APPROVED">Approuvé</option>
                                                    <option value="REJECTED">Rejeté</option>
                                                    <option value="CANCELLED">Annulé</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-5 col-item">
                                            <div class="input-block mb-0">
                                                <input type="text" class="form-control" placeholder="Rechercher étudiant..." 
                                                       [(ngModel)]="searchTerm" [ngModelOptions]="{standalone: true}">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3 col-item">
                                            <div class="download-widra">
                                                <button class="btn btn-primary" (click)="applyFilters()">
                                                    <i class="feather-filter"></i> Filtrer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="comman-space pb-0">
                            <div class="settings-referral-blk course-instruct-blk table-responsive">

                                <!-- Acceptance Proofs Table -->
                                <table class="table table-nowrap mb-0">
                                    <thead>
                                        <tr>
                                            <th>
                                                <div class="form-check instruct-check-list">
                                                    <input class="form-check-input" type="checkbox" (change)="selectAll($event)">
                                                </div>
                                            </th>
                                            <th>Document</th>
                                            <th>Statut</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let proof of filteredProofs">
                                            <td>
                                                <div class="form-check instruct-check-list">
                                                    <input class="form-check-input" type="checkbox" 
                                                           [checked]="isSelected(proof.id!)" (change)="toggleSelection(proof.id!)">
                                                </div>
                                            </td>
                                            <td>
                                                <!-- Download button for acceptance document -->
                                                <div class="btn-group">
                                                    <button *ngIf="proof.documentFilename" class="btn btn-sm btn-outline-primary"
                                                            (click)="downloadDocument(proof.id!)" title="Télécharger le document">
                                                        <i class="feather-download"></i> {{proof.documentFilename}}
                                                    </button>
                                                    <span *ngIf="!proof.documentFilename" class="text-muted">
                                                        Aucun document
                                                    </span>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge" [ngClass]="{
                                                    'bg-warning': proof.status === 'PENDING_UPLOAD',
                                                    'bg-primary': proof.status === 'UNDER_REVIEW',
                                                    'bg-success': proof.status === 'APPROVED',
                                                    'bg-danger': proof.status === 'REJECTED',
                                                    'bg-secondary': proof.status === 'CANCELLED'
                                                }">
                                                    {{ getStatusText(proof.status) }}
                                                </span>
                                            </td>
                                            <td>{{proof.lastUpdated | date:'dd/MM/yy'}}</td>
                                            <td>
                                                <div class="btn-group">
                                                    <!-- Status change dropdown -->
                                                    <select class="form-select form-select-sm" 
                                                            [value]="proof.status"
                                                            (change)="onStatusChange($event, proof.id!)">
                                                        <option value="PENDING_UPLOAD">En attente document</option>
                                                        <option value="UNDER_REVIEW">En revue</option>
                                                        <option value="APPROVED">Approuvé</option>
                                                        <option value="REJECTED">Rejeté</option>
                                                        <option value="CANCELLED">Annulé</option>
                                                    </select>
                                                    
                                                    <!-- View details button -->
                                                    <button class="btn btn-sm btn-outline-info" (click)="viewDetails(proof)">
                                                        <i class="feather-eye"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <!-- /Acceptance Proofs Table -->	

                            </div>									
                        </div>
                        
                        <!-- Bulk Actions -->
                        <div class="comman-space border-top" *ngIf="selectedProofs.length > 0">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <p class="mb-0">{{selectedProofs.length}} justificatif(s) sélectionné(s)</p>
                                </div>
                                <div class="col-md-6 text-end">
                                    <div class="btn-group">
                                        <select class="form-select form-select-sm me-2" style="width: auto;" 
                                                [(ngModel)]="bulkActionStatus">
                                            <option value="APPROVED">Marquer comme approuvé</option>
                                            <option value="REJECTED">Marquer comme rejeté</option>
                                            <option value="UNDER_REVIEW">Remettre en revue</option>
                                        </select>
                                        <button class="btn btn-primary btn-sm" (click)="applyBulkAction()">
                                            Appliquer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>	
<!-- /Admin Acceptance Proofs Dashboard -->

<app-footer></app-footer>