<app-navbar3></app-navbar3>
<div class="page-content">
  <div class="container">
    <div class="row">

      <!-- Sidebar -->
      <div class="col-xl-3 col-lg-4 col-md-12 theiaStickySidebar">
        <app-sidebar2></app-sidebar2>
      </div>
      <!-- /Sidebar -->

      <!-- Instructor Dashboard -->
      <div class="col-xl-9 col-lg-8 col-md-12">	
        <div class="row">
          <div class="col-md-12">
            <div class="settings-widget">
              <div class="settings-inner-blk p-0">
                <div class="sell-course-head comman-space">
                  <h3>Réclamations des Étudiants</h3>
                  <p>Gérez les réclamations reçues des étudiants.</p>
                </div>
                
                <!-- Tabs Navigation -->
                <div class="comman-space pb-0">
                  <div class="instruct-search-blk mb-0">
                    <div class="show-filter all-select-blk">
                      <div class="row gx-2 align-items-center">	
                        <div class="col-md-12">
                          <div class="btn-group" role="group">
                            <button type="button" 
                                    class="btn" 
                                    [class.btn-primary]="selectedTab === 'unresolved'"
                                    [class.btn-outline-primary]="selectedTab !== 'unresolved'"
                                    (click)="switchTab('unresolved')">
                              Non Résolues ({{unresolvedReclamations.length}})
                            </button>
                            <button type="button" 
                                    class="btn"
                                    [class.btn-primary]="selectedTab === 'resolved'"
                                    [class.btn-outline-primary]="selectedTab !== 'resolved'"
                                    (click)="switchTab('resolved')">
                              Résolues ({{resolvedReclamations.length}})
                            </button>
                          </div>
                        </div>	
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Loading Spinner -->
                <div *ngIf="isLoading" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                  </div>
                </div>

                <!-- Reclamations List -->
                <div *ngIf="!isLoading">
                  <div *ngFor="let reclamation of reclamations" class="comman-space bdr-bottom-line">
                    <div class="instruct-review-blk">
                      <div class="review-item">
                        <div class="instructor-wrap border-0 m-0">
                          <div class="about-instructor">
                            <div class="abt-instructor-img">
                              <a href="javascript:void(0);">
                                <img src="assets/img/user/user1.jpg" alt="img" class="img-fluid">
                              </a>
                            </div>
                            <div class="instructor-detail">
  <h5>
    <a href="javascript:void(0);">
      {{reclamation.student?.firstname}} {{reclamation.student?.lastname}}
    </a>
  </h5>
  <p class="mb-1">{{reclamation.subject}}</p>
  <small class="text-muted">
    {{reclamation.submissionDate | date:'dd/MM/yyyy à HH:mm'}}
  </small>
</div>
                          </div>
                          <div class="rating">							
                            <span class="badge" [class.badge-success]="reclamation.resolved" [class.badge-warning]="!reclamation.resolved">
                              {{getStatusText(reclamation)}}
                            </span>
                          </div>
                        </div>
                        <p class="rev-info">{{reclamation.description}}</p>
                        
                        <!-- Response Form -->
                        <div *ngIf="selectedReclamationId === reclamation.id" class="response-form mt-3">
                          <textarea 
                            class="form-control" 
                            rows="3" 
                            placeholder="Tapez votre réponse ici..."
                            [(ngModel)]="responseText">
                          </textarea>
                          <div class="mt-2">
                            <button class="btn btn-success me-2" (click)="submitResponse(reclamation.id!)">
                              Envoyer
                            </button>
                            <button class="btn btn-secondary" (click)="cancelResponse()">
                              Annuler
                            </button>
                          </div>
                        </div>

                        <!-- Admin Response Display -->
                        <div *ngIf="reclamation.resolved && reclamation.adminResponse" class="alert alert-success mt-3">
                          <strong>Votre réponse:</strong><br>
                          {{reclamation.adminResponse}}
                          <div class="text-muted small mt-1">
                            Répondu le {{reclamation.responseDate | date:'dd/MM/yyyy à HH:mm'}}
                          </div>
                        </div>

                        <!-- Respond Button -->
                        <a *ngIf="!reclamation.resolved && selectedReclamationId !== reclamation.id" 
                           href="javascript:void(0);" 
                           class="btn btn-reply"
                           (click)="openResponseForm(reclamation.id!)">
                          <i class="feather-corner-up-left"></i> Répondre
                        </a>
                      </div>
                    </div>								
                  </div>

                  <!-- No Reclamations Message -->
                  <div *ngIf="reclamations.length === 0" class="comman-space">
                    <div class="alert alert-info">
                      Aucune réclamation {{selectedTab === 'unresolved' ? 'non résolue' : 'résolue'}} pour le moment.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>	
      <!-- /Instructor Dashboard -->

    </div>
  </div>
</div>

<app-footer></app-footer>